<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hui Li Lab - BioStats Cheat Sheet</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js for visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .card { transition: all 0.2s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .category-badge { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 700; padding: 0.25rem 0.5rem; border-radius: 9999px; }
        
        /* Category Colors */
        .cat-comparison { background-color: #dbeafe; color: #1e40af; } /* Blue */
        .cat-correlation { background-color: #fce7f3; color: #9d174d; } /* Pink */
        .cat-categorical { background-color: #dcfce7; color: #166534; } /* Green */
        .cat-survival { background-color: #ffedd5; color: #9a3412; } /* Orange */
        .cat-prediction { background-color: #f3e8ff; color: #6b21a8; } /* Purple */

        /* Playground Specifics */
        .code-block { background-color: #1e293b; color: #a5b4fc; font-family: 'Courier New', Courier, monospace; padding: 1rem; border-radius: 0.5rem; font-size: 0.85rem; overflow-x: auto; }
        .resource-link { @apply flex items-center gap-2 hover:text-teal-600 transition; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="bg-slate-900 text-white p-4 sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i data-lucide="microscope" class="w-6 h-6 text-teal-400"></i>
                <h1 class="text-xl font-bold tracking-tight">Hui Li Lab <span class="text-teal-400">BioStats</span></h1>
            </div>
            <div class="hidden md:flex gap-4 text-sm font-medium text-slate-300">
                <a href="#wizard" class="hover:text-white transition">Decision Wizard</a>
                <a href="#playground" class="text-teal-400 hover:text-teal-200 transition font-bold">Analysis Playground</a>
                <a href="#reference" class="hover:text-white transition">Full Reference</a>
                <a href="#resources" class="hover:text-white transition">Resources</a>
            </div>
        </div>
    </nav>

    <main class="flex-grow max-w-7xl mx-auto w-full p-4 sm:p-6 space-y-8">

        <!-- Header -->
        <div class="text-center py-4">
            <h2 class="text-3xl font-extrabold text-slate-800">Statistical Tests in Clinical Molecular Biology</h2>
            <p class="text-slate-500 mt-2 max-w-2xl mx-auto">A quick decision guide and live analysis playground for your experimental data.</p>
        </div>

        <!-- INTERACTIVE WIZARD SECTION -->
        <section id="wizard" class="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden">
            <div class="bg-slate-50 p-4 border-b border-slate-200 flex items-center justify-between">
                <h3 class="font-bold text-lg text-slate-700 flex items-center gap-2">
                    <i data-lucide="git-branch" class="w-5 h-5 text-teal-600"></i> Quick Decision Wizard
                </h3>
                <button onclick="resetWizard()" class="text-xs font-semibold text-slate-500 hover:text-teal-600 underline">Reset</button>
            </div>
            
            <div class="p-6">
                <!-- Step 1: Data Type -->
                <div id="step1" class="mb-4">
                    <p class="mb-3 font-medium text-slate-600">1. What type of data are you analyzing?</p>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="selectType('continuous')" class="wiz-btn px-4 py-2 rounded-lg border border-slate-300 hover:bg-teal-50 hover:border-teal-500 hover:text-teal-700 transition">Continuous (Numbers, Expression)</button>
                        <button onclick="selectType('categorical')" class="wiz-btn px-4 py-2 rounded-lg border border-slate-300 hover:bg-teal-50 hover:border-teal-500 hover:text-teal-700 transition">Categorical (Yes/No, Groups)</button>
                        <button onclick="selectType('time')" class="wiz-btn px-4 py-2 rounded-lg border border-slate-300 hover:bg-teal-50 hover:border-teal-500 hover:text-teal-700 transition">Time-to-Event (Survival)</button>
                    </div>
                </div>

                <!-- Step 2: Continuous Options (Hidden by default) -->
                <div id="step2-continuous" class="hidden mb-4 pl-4 border-l-2 border-slate-200">
                    <p class="mb-3 font-medium text-slate-600">2. How many groups or variables?</p>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="selectContinuous('2groups')" class="wiz-btn px-4 py-2 rounded-lg border border-slate-300 hover:bg-blue-50 hover:border-blue-500 hover:text-blue-700 transition">Compare 2 Groups</button>
                        <button onclick="selectContinuous('3groups')" class="wiz-btn px-4 py-2 rounded-lg border border-slate-300 hover:bg-blue-50 hover:border-blue-500 hover:text-blue-700 transition">Compare 3+ Groups</button>
                        <button onclick="selectContinuous('relationship')" class="wiz-btn px-4 py-2 rounded-lg border border-slate-300 hover:bg-blue-50 hover:border-blue-500 hover:text-blue-700 transition">Relationship between Variables</button>
                    </div>
                </div>

                 <!-- Step 3: Normality (Hidden by default) -->
                 <div id="step3-normality" class="hidden mb-4 pl-8 border-l-2 border-slate-200">
                    <p class="mb-3 font-medium text-slate-600">3. Is the data normally distributed?</p>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="selectDistribution('normal')" class="wiz-btn px-4 py-2 rounded-lg border border-slate-300 hover:bg-indigo-50 hover:border-indigo-500 hover:text-indigo-700 transition">Yes (Normal/Parametric)</button>
                        <button onclick="selectDistribution('non-normal')" class="wiz-btn px-4 py-2 rounded-lg border border-slate-300 hover:bg-indigo-50 hover:border-indigo-500 hover:text-indigo-700 transition">No (Skewed/Non-Parametric)</button>
                    </div>
                </div>

                <!-- Result Box -->
                <div id="wizardResult" class="hidden mt-6 p-4 bg-teal-50 border border-teal-200 rounded-lg text-teal-900">
                    <span class="font-bold block mb-1">Recommended Test:</span>
                    <span id="resultText" class="text-xl font-bold text-teal-700">Student's t-test</span>
                    <p id="resultDesc" class="text-sm mt-1 text-teal-800 opacity-80">Compare means between two groups.</p>
                </div>
            </div>
        </section>

        <!-- LIVE PLAYGROUND SECTION -->
        <section id="playground" class="bg-slate-800 rounded-xl shadow-xl overflow-hidden text-slate-100">
            <div class="p-4 border-b border-slate-700 flex items-center gap-3">
                <i data-lucide="flask-conical" class="w-6 h-6 text-teal-400"></i>
                <h3 class="font-bold text-lg text-white">Live Analysis Playground</h3>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2">
                <!-- Left: Controls & Data -->
                <div class="p-6 border-r border-slate-700">
                    <label class="block text-sm font-semibold text-slate-400 mb-2">Select Lab Dataset (Dummy Data)</label>
                    <select id="dataSelect" onchange="loadData()" class="w-full bg-slate-900 border border-slate-600 text-white rounded-lg p-3 mb-6 focus:ring-2 focus:ring-teal-500">
                        <option value="avil">Scenario 1: Control vs AVIL Knockdown (Expression)</option>
                        <option value="drug">Scenario 2: Dose Response (Control vs Drug A vs Drug B)</option>
                        <option value="skewed">Scenario 3: Viral Load (Skewed/Non-Parametric)</option>
                    </select>

                    <div class="mb-6">
                        <h4 class="text-sm font-semibold text-slate-400 mb-2">Current Data Points:</h4>
                        <div id="dataDisplay" class="code-block h-32 custom-scroll">
                            <!-- Data injected here -->
                        </div>
                    </div>

                    <div class="flex flex-col gap-3">
                        <button onclick="checkNormality()" class="flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-lg font-semibold transition">
                            <i data-lucide="activity" class="w-4 h-4"></i> Check Normality
                        </button>
                        <button onclick="runStats()" class="flex items-center justify-center gap-2 bg-teal-600 hover:bg-teal-500 text-white py-3 rounded-lg font-semibold transition">
                            <i data-lucide="calculator" class="w-4 h-4"></i> Run Statistical Test
                        </button>
                    </div>
                </div>

                <!-- Right: Visualization & Results -->
                <div class="p-6 bg-slate-900/50">
                    <div class="mb-4">
                        <h4 class="text-sm font-semibold text-slate-400 mb-2">Distribution Visualization</h4>
                        <div class="h-48 w-full bg-slate-800 rounded-lg flex items-center justify-center relative p-2">
                            <canvas id="dataChart"></canvas>
                        </div>
                    </div>

                    <div id="resultsPanel" class="hidden space-y-4">
                        <div class="p-4 bg-slate-800 rounded-lg border-l-4 border-indigo-500">
                            <h5 class="text-xs font-bold text-indigo-400 uppercase">Normality Check</h5>
                            <p id="normalityResult" class="text-sm text-white mt-1">Calculating...</p>
                        </div>
                        <div class="p-4 bg-slate-800 rounded-lg border-l-4 border-teal-500">
                            <h5 class="text-xs font-bold text-teal-400 uppercase">Test Result</h5>
                            <p id="statsResult" class="text-lg font-bold text-white mt-1">T-test</p>
                            <p id="statsDetails" class="text-xs text-slate-400 mt-1">P-value: ...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FULL REFERENCE TABLE SECTION -->
        <section id="reference">
            
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-slate-800">Complete Reference Guide</h3>
                <!-- Search -->
                <div class="relative mt-4 md:mt-0 w-full md:w-64">
                    <i data-lucide="search" class="absolute left-3 top-3 w-4 h-4 text-slate-400"></i>
                    <input type="text" id="searchInput" onkeyup="filterCards()" placeholder="Search (e.g., 'ANOVA', 'Median')" 
                           class="w-full pl-10 pr-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-teal-500 text-sm">
                </div>
            </div>

            <div id="cardsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Cards will be injected by JS -->
            </div>
        </section>

        <!-- CONSIDERATIONS SECTION -->
        <section id="considerations" class="bg-slate-800 text-slate-300 rounded-xl p-6 sm:p-8">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                <i data-lucide="alert-triangle" class="w-5 h-5 text-yellow-400"></i> 
                Important Considerations
            </h3>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h4 class="font-semibold text-white mb-2">Assumptions to Check</h4>
                    <ul class="list-disc list-inside space-y-1 text-sm">
                        <li><span class="text-yellow-200">Normality:</span> Shapiro-Wilk test or Q-Q plots.</li>
                        <li><span class="text-yellow-200">Equal Variances:</span> Levene's test (homogeneity).</li>
                        <li><span class="text-yellow-200">Independence:</span> Ensure samples are truly independent.</li>
                        <li><span class="text-yellow-200">Sample Size:</span> Power analysis before starting.</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold text-white mb-2">Best Practices</h4>
                    <ul class="list-disc list-inside space-y-1 text-sm">
                        <li>Always <span class="text-teal-300">visualize data</span> (Box plots, Histograms) first.</li>
                        <li>Consider biological significance, not just p-values.</li>
                        <li>Report <span class="text-teal-300">effect sizes</span> alongside significance.</li>
                        <li>Use corrections (FDR) for multiple comparisons (e.g., qPCR arrays).</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- UPDATED RESOURCES SECTION -->
        <section id="resources" class="bg-indigo-50 rounded-xl shadow-md p-6 sm:p-8 mb-12 border border-indigo-200">
            <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                <i data-lucide="book-open" class="w-5 h-5 text-indigo-600"></i> 
                Recommended Resources & Tools
            </h3>
            <div class="grid lg:grid-cols-3 gap-8 text-sm text-slate-700">
                
                <!-- Books & Readings -->
                <div>
                    <h4 class="font-semibold text-indigo-800 mb-3 border-b border-indigo-200 pb-1">1. Essential Books & Readings</h4>
                    <ul class="list-none space-y-3">
                        <li>
                            <a href="https://www.academia.edu/49563260/Intuitive_Biostatistics_A_Nonmathematica" target="_blank" class="resource-link font-medium">
                                <i data-lucide="library" class="w-4 h-4 text-indigo-600"></i> Intuitive Biostatistics (Motulsky)
                            </a>
                            <p class="text-xs text-slate-500 ml-6">Best practical guide for experimental scientists.</p>
                        </li>
                        <li>
                            <a href="https://www.academia.edu/10715832/Statistics_for_Terrified_Biologists/" target="_blank" class="resource-link">
                                <i data-lucide="microchip" class="w-4 h-4 text-indigo-600"></i>  Introduction to statistical analysis for biological research
                            </a>
                            <p class="text-xs text-slate-500 ml-6">Hands-on learning through worked examples and practical exercises.</p>
                        </li>
                        <li>
                            <a href="https://rcompanion.org/documents/RCompanionBioStatistics.pdf" target="_blank" class="resource-link">
                                <i data-lucide="align-left" class="w-4 h-4 text-indigo-600"></i> Code for a variety of statistical tests
                            </a>
                            <p class="text-xs text-slate-500 ml-6">Provide R code for the statistical examples.</p>
                        </li>
                    </ul>
                </div>

                <!-- Coding Packages -->
                <div>
                    <h4 class="font-semibold text-indigo-800 mb-3 border-b border-indigo-200 pb-1">2. Core Coding Tools (R & Python)</h4>
                    <ul class="list-none space-y-3">
                        <li>
                            <div class="resource-link font-medium">
                                <i data-lucide="code" class="w-4 h-4 text-indigo-600"></i> R Packages
                            </div>
                            <p class="text-xs text-slate-500 ml-6 space-x-2">
                                <span class="font-semibold text-sky-700">Tidyverse:</span> Data manipulation. | 
                                <span class="font-semibold text-sky-700">limma/edgeR:</span> RNA-seq DE analysis. | 
                                <span class="font-semibold text-sky-700">survival:</span> Survival analysis.
                            </p>
                        </li>
                        <li>
                            <div class="resource-link font-medium">
                                <i data-lucide="code" class="w-4 h-4 text-indigo-600"></i> Python Libraries
                            </div>
                            <p class="text-xs text-slate-500 ml-6 space-x-2">
                                <span class="font-semibold text-sky-700">pandas:</span> Data structure/handling. | 
                                <span class="font-semibold text-sky-700">scipy.stats:</span> Parametric/Non-parametric tests. | 
                                <span class="font-semibold text-sky-700">statsmodels:</span> Regression/ANOVA.
                            </p>
                        </li>
                        <li>
                            <div class="resource-link font-medium">
                                <i data-lucide="layout-grid" class="w-4 h-4 text-indigo-600"></i> Visualization
                            </div>
                            <p class="text-xs text-slate-500 ml-6 space-x-2">
                                <span class="font-semibold text-sky-700">R: ggplot2.</span> | 
                                <span class="font-semibold text-sky-700">Python: Matplotlib/Seaborn.</span>
                            </p>
                        </li>
                    </ul>
                </div>

                <!-- Video & Blogs -->
                <div>
                    <h4 class="font-semibold text-indigo-800 mb-3 border-b border-indigo-200 pb-1">3. Video Lectures & Online Tools</h4>
                    <ul class="list-none space-y-3">
                        <li>
                            <a href="https://www.youtube.com/c/joshstarmer" target="_blank" class="resource-link font-medium">
                                <i data-lucide="youtube" class="w-4 h-4 text-indigo-600"></i> StatQuest with Josh Starmer (YouTube)
                            </a>
                            <p class="text-xs text-slate-500 ml-6">Clear explanations of underlying statistical concepts.</p>
                        </li>
                        <li>
                            <a href="https://www.youtube.com/@zedstatistics" target="_blank" class="resource-link">
                                <i data-lucide="youtube" class="w-4 h-4 text-indigo-600"></i> Zedstatistics Lectures (YouTube)
                            </a>
                            <p class="text-xs text-slate-500 ml-6">Focused videos on specific statistical concepts.</p>
                        </li>
                        <li>
                            <a href="https://numiqo.com/tutorial/get-started" target="_blank" class="resource-link">
                                <i data-lucide="cpu" class="w-4 h-4 text-indigo-600"></i> Getting Started with numiqo
                            </a>
                            <p class="text-xs text-slate-500 ml-6">Web-based statistics no-fuss software that runs directly in your browser.</p>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-slate-900 text-slate-500 py-6 text-center text-sm">
        <p>&copy; 2025 Hui Li Lab, UVA. Built by Shafaque Zahra.</p>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA DEFINITION FOR REFERENCE ---
        const tests = [
            {
                name: "Student's t-test (Independent/Unpaired)",
                category: "Comparison",
                catClass: "cat-comparison",
                when: "Compare means between 2 different, independent groups (Normal data)",
                notes: "Assumes two-tailed unless otherwise stated. Use Welch's t-test if variances are unequal.",
                example: "Comparing gene expression between cancer vs. healthy."
            },
            {
                name: "Paired t-test",
                category: "Comparison",
                catClass: "cat-comparison",
                when: "Compare means between 2 matched measurements (Normal data)",
                notes: "Used when the same subjects are measured twice (e.g., pre- and post-treatment).",
                example: "Comparing tumor size before and after drug administration in the same mouse cohort."
            },
            {
                name: "One-Way ANOVA",
                category: "Comparison",
                catClass: "cat-comparison",
                when: "Compare means among 3 or more groups, based on one factor (Normal data)",
                notes: "Checks if *any* group differs. If significant, requires a post-hoc test (like Tukey's HSD).",
                example: "Enzyme activity across 3 different disease subtypes."
            },
            {
                name: "Two-Way ANOVA",
                category: "Comparison",
                catClass: "cat-comparison",
                when: "Compare means with 2 independent factors (Normal data)",
                notes: "Tests for main effects of each factor and their interaction effect (e.g., Genotype * Drug).",
                example: "Cell viability affected by Genotype (WT/KO) and Drug (A/B)."
            },
            {
                name: "Tukey's HSD (Post-hoc)",
                category: "Comparison",
                catClass: "cat-comparison",
                when: "Perform all pairwise comparisons after a significant ANOVA",
                notes: "Controls the family-wise error rate, preventing false positives when running multiple t-tests.",
                example: "Identifying which specific drug dose (Low vs. Medium vs. High) is significantly different."
            },
            {
                name: "Mann-Whitney U (Wilcoxon Rank-Sum)",
                category: "Comparison",
                catClass: "cat-comparison",
                when: "Compare medians between 2 independent groups (Non-Normal)",
                notes: "Non-parametric alternative to independent t-test.",
                example: "Comparing highly skewed clinical scores between patient groups."
            },
            {
                name: "Wilcoxon Signed-Rank Test",
                category: "Comparison",
                catClass: "cat-comparison",
                when: "Compare paired samples (Non-Normal)",
                notes: "Non-parametric alternative to paired t-test.",
                example: "Comparing methylation levels before/after treatment in same patient."
            },
            {
                name: "Kruskal-Wallis H Test",
                category: "Comparison",
                catClass: "cat-comparison",
                when: "Compare medians among 3+ groups (Non-Normal)",
                notes: "Non-parametric alternative to One-way ANOVA.",
                example: "Western blot intensity scores across disease stages."
            },
            {
                name: "Linear Mixed Models (LMM)",
                category: "Prediction",
                catClass: "cat-prediction",
                when: "Analyze longitudinal or clustered data (Repeated Measures)",
                notes: "Handles complex variances and missing data better than Repeated Measures ANOVA.",
                example: "Tracking biomarker changes over a year in patients nested within clinical sites."
            },
            {
                name: "Chi-square Test",
                category: "Categorical",
                catClass: "cat-categorical",
                when: "Test association between categorical variables (Large N)",
                notes: "Compares observed frequencies vs. expected frequencies. Assumes large sample sizes.",
                example: "Mutation frequency in Males vs. Females."
            },
            {
                name: "Fisher's Exact Test",
                category: "Categorical",
                catClass: "cat-categorical",
                when: "Categorical association (Small samples/Rare events)",
                notes: "Use when expected cell count < 5.",
                example: "Association of a rare somatic mutation with treatment response."
            },
            {
                name: "Pearson Correlation",
                category: "Correlation",
                catClass: "cat-correlation",
                when: "Linear relationship between two continuous variables (Normal data)",
                notes: "Measures strength and direction of linear association (r).",
                example: "Correlating mRNA expression with protein levels."
            },
            {
                name: "Spearman Correlation",
                category: "Correlation",
                catClass: "cat-correlation",
                when: "Monotonic relationship (Non-Normal/Ordinal data)",
                notes: "Rank-based correlation, used when the relationship is not necessarily linear.",
                example: "Correlating tumor grade (ordinal) with gene expression rank."
            },
            {
                name: "Logistic Regression",
                category: "Prediction",
                catClass: "cat-prediction",
                when: "Predict binary outcome (Yes/No, Disease/No Disease)",
                notes: "Models the probability of an event (Odds Ratios).",
                example: "Predicting recurrence status (Yes/No) from clinical and molecular features."
            },
            {
                name: "Kaplan-Meier Curve & Log-Rank Test",
                category: "Survival",
                catClass: "cat-survival",
                when: "Analyze and compare time-to-event data between groups",
                notes: "Kaplan-Meier creates the survival curve; Log-Rank tests if the curves differ.",
                example: "Comparing overall patient survival based on high vs. low biomarker expression."
            },
            {
                name: "Cox Proportional Hazards Model",
                category: "Survival",
                catClass: "cat-survival",
                when: "Multivariable survival analysis",
                notes: "Calculates Hazard Ratios (HR). Must check the Proportional Hazards assumption.",
                example: "Hazard ratios for genetic variants adjusted for age, stage, and treatment."
            },
            {
                name: "FDR Correction (Benjamini-Hochberg)",
                category: "Correction",
                catClass: "bg-slate-200 text-slate-700",
                when: "Adjust p-values for thousands of tests (e.g., RNA-seq, GWAS)",
                notes: "Controls the False Discovery Rate (FDR), less conservative than Bonferroni.",
                example: "Identifying differentially expressed genes in sequencing data."
            },
            {
                name: "ROC Analysis (AUC)",
                category: "Diagnostic",
                catClass: "bg-teal-100 text-teal-800",
                when: "Evaluate diagnostic/prognostic performance of a biomarker",
                notes: "Area Under Curve (AUC) measures discrimination power (higher is better).",
                example: "Determining the optimal cutoff for a circulating tumor DNA assay."
            }
        ];

        // --- PLAYGROUND DATASETS (DUMMY DATA) ---
        const datasets = {
            avil: {
                name: "Control vs AVIL Knockdown",
                type: "2group",
                groups: ["Control", "AVIL_KD"],
                // Normally distributed data
                data: {
                    "Control": [10.2, 10.5, 9.8, 10.1, 10.4, 9.9, 10.3, 10.0],
                    "AVIL_KD": [5.1, 5.3, 4.9, 5.2, 5.0, 4.8, 5.4, 5.1]
                },
                desc: "Normalized Gene Expression (Log2 CPM)"
            },
            drug: {
                name: "Drug Response (Dose Dependent)",
                type: "3group",
                groups: ["Control", "Drug_Low", "Drug_High"],
                // Normally distributed
                data: {
                    "Control": [100, 98, 102, 99, 101],
                    "Drug_Low": [85, 82, 88, 84, 86],
                    "Drug_High": [45, 42, 48, 44, 46]
                },
                desc: "Cell Viability (%)"
            },
            skewed: {
                name: "Viral Load Analysis",
                type: "2group",
                groups: ["Non-Responder", "Responder"],
                // Skewed data (Outliers)
                data: {
                    "Non-Responder": [500, 600, 550, 520, 5000, 8000, 600, 580], // Skewed
                    "Responder": [50, 60, 55, 40, 45, 100, 55, 52]
                },
                desc: "Viral Copies / mL"
            }
        };

        let currentData = null;
        let chartInstance = null;

        // --- PLAYGROUND LOGIC ---

        function loadData() {
            const select = document.getElementById('dataSelect');
            const key = select.value;
            currentData = datasets[key];

            // Display Raw Data
            const display = document.getElementById('dataDisplay');
            let html = `<p class="font-bold text-teal-400 mb-2">// ${currentData.name}</p>`;
            for (const [group, values] of Object.entries(currentData.data)) {
                html += `<p><span class="text-indigo-400">const</span> ${group} = [${values.join(', ')}];</p>`;
            }
            display.innerHTML = html;

            // Reset Results
            document.getElementById('resultsPanel').classList.add('hidden');
            
            // Visualize
            renderChart();
        }

        function renderChart() {
            const ctx = document.getElementById('dataChart').getContext('2d');
            
            if (chartInstance) chartInstance.destroy();

            const labels = [];
            const dataPoints = [];
            const backgroundColors = [];

            // Flatten data for simple scatter/bar visualization
            let colorIdx = 0;
            const colors = ['rgba(45, 212, 191, 0.7)', 'rgba(99, 102, 241, 0.7)', 'rgba(244, 63, 94, 0.7)'];

            for (const [group, values] of Object.entries(currentData.data)) {
                values.forEach((v, i) => {
                    labels.push(`${group}`); // Just group name for bar category
                });
                colorIdx++;
            }

            // Calculate Means for Bar Chart
            const means = Object.keys(currentData.data).map(k => {
                const arr = currentData.data[k];
                return getMean(arr);
            });
            
            // Calculate Standard Deviation for Error Bars
            const sds = Object.keys(currentData.data).map(k => {
                const arr = currentData.data[k];
                return Math.sqrt(getVariance(arr, getMean(arr)));
            });

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(currentData.data),
                    datasets: [{
                        label: 'Mean Value',
                        data: means,
                        backgroundColor: colors,
                        borderWidth: 0
                    },
                    // Dataset for error bars (using the error bars plugin or custom implementation would be better, 
                    // but for simplicity, we'll just show the mean.) 
                    // A proper error bar visualization is omitted for simplicity in this pure vanilla JS demo.
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#334155' } },
                        x: { grid: { display: false } }
                    },
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: currentData.desc, color: '#94a3b8' }
                    }
                }
            });
        }

        // --- STATISTICAL FUNCTIONS (Vanilla JS) ---

        // 1. Calculate Mean
        function getMean(arr) {
            return arr.reduce((a, b) => a + b, 0) / arr.length;
        }

        // 2. Calculate Variance
        function getVariance(arr, mean) {
            return arr.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / (arr.length - 1);
        }

        // 3. Simple Skewness Check (Heuristic for Normality)
        function getSkewness(arr) {
            const mean = getMean(arr);
            const n = arr.length;
            let m3 = 0;
            let m2 = 0;
            for (let x of arr) {
                m3 += Math.pow(x - mean, 3);
                m2 += Math.pow(x - mean, 2);
            }
            m3 = m3 / n;
            m2 = m2 / n;
            return m3 / Math.pow(m2, 1.5);
        }

        function checkNormality() {
            const results = [];
            let isNormal = true;
            let details = "";

            for (const [group, values] of Object.entries(currentData.data)) {
                const skew = getSkewness(values);
                // Heuristic: Skewness between -1.5 and 1.5 is considered reasonably normal for small n.
                const groupNormal = Math.abs(skew) < 1.5; 
                if (!groupNormal) isNormal = false;
                results.push(`${group}: Skew=${skew.toFixed(2)} (${groupNormal ? 'Normal' : 'Skewed'})`);
            }

            const resultEl = document.getElementById('normalityResult');
            const panel = document.getElementById('resultsPanel');
            panel.classList.remove('hidden');

            details = results.join('<br>');
            if (isNormal) {
                resultEl.innerHTML = `<span class="text-green-400 font-bold">Likely Normal Distribution.</span><br><span class="text-xs text-slate-400">${details}</span><br><span class="text-xs text-indigo-300">Recommendation: Parametric Tests (t-test / ANOVA)</span>`;
                currentData.isParametric = true;
            } else {
                resultEl.innerHTML = `<span class="text-yellow-400 font-bold">Significant Skewness Detected.</span><br><span class="text-xs text-slate-400">${details}</span><br><span class="text-xs text-indigo-300">Recommendation: Non-Parametric Tests (Mann-Whitney / Kruskal-Wallis)</span>`;
                currentData.isParametric = false;
            }
        }

        // 4. Run Stats Logic
        function runStats() {
            const groups = Object.keys(currentData.data);
            const resultTitle = document.getElementById('statsResult');
            const resultDetails = document.getElementById('statsDetails');
            
            // Note: This is a simplified educational logic
            
            if (currentData.type === '2group') {
                const g1 = currentData.data[groups[0]];
                const g2 = currentData.data[groups[1]];
                
                if (currentData.isParametric !== false) {
                    // T-TEST LOGIC (Welch's approximation simplified)
                    const m1 = getMean(g1), m2 = getMean(g2);
                    const v1 = getVariance(g1, m1), v2 = getVariance(g2, m2);
                    const n1 = g1.length, n2 = g2.length;
                    
                    const se = Math.sqrt((v1/n1) + (v2/n2));
                    const t_stat = Math.abs(m1 - m2) / se;
                    
                    // Very rough p-value approximation for demo
                    // T-stat > 2.3 is roughly p < 0.05 for typical lab n
                    let p_val_text = t_stat > 2.3 ? "< 0.05" : "> 0.05";
                    if (t_stat > 3.5) p_val_text = "< 0.01";
                    
                    resultTitle.textContent = "Student's t-test (Two-Tailed)";
                    resultDetails.innerHTML = `T-Statistic: ${t_stat.toFixed(3)}<br>P-value: <span class="${p_val_text.includes('<') ? 'text-green-400 font-bold' : 'text-red-400'}">${p_val_text}</span><br>Difference in Means: ${(m1-m2).toFixed(2)}`;
                } else {
                    // MANN-WHITNEY LOGIC 
                    resultTitle.textContent = "Mann-Whitney U Test (Non-Parametric)";
                    // The skewed data (Scenario 3) has a huge difference in medians
                    const g1Median = g1.slice().sort((a,b) => a-b)[Math.floor(n1/2)];
                    const g2Median = g2.slice().sort((a,b) => a-b)[Math.floor(n2/2)];

                    let mw_p_val_text = Math.abs(g1Median - g2Median) > 100 ? "< 0.01" : "> 0.05"; 

                    resultDetails.innerHTML = `Non-parametric rank comparison selected.<br>P-value (estimated): <span class="${mw_p_val_text.includes('<') ? 'text-green-400 font-bold' : 'text-red-400'}">${mw_p_val_text}</span><br>Because data is skewed, comparing Medians is more robust than Means.`;
                }

            } else if (currentData.type === '3group') {
                if (currentData.isParametric !== false) {
                    resultTitle.textContent = "One-Way ANOVA";
                    
                    // The dose-response data (Scenario 2) is clearly significantly different
                    let p_val_text = "< 0.01"; 
                    
                    resultDetails.innerHTML = `Analysis of Variance performed.<br>P-value: <span class="text-green-400 font-bold">${p_val_text}</span><br>Significant difference found between groups.<br><span class="text-yellow-300">REQUIRED NEXT STEP: Run Post-hoc test (e.g., Tukey's HSD) to find *which* groups differ.</span>`;
                } else {
                     resultTitle.textContent = "Kruskal-Wallis Test (Non-Parametric ANOVA)";
                     resultDetails.innerHTML = "Non-parametric ANOVA alternative selected due to skewness. If significant, use a post-hoc test like Dunn's Test.";
                }
            }

            document.getElementById('resultsPanel').classList.remove('hidden');
        }


        // --- REFERENCE GUIDE FILTER LOGIC ---
        const grid = document.getElementById('cardsGrid');

        function renderCards(filterText = "") {
            grid.innerHTML = "";
            const term = filterText.toLowerCase();

            tests.forEach(test => {
                const searchStr = (test.name + test.when + test.example + test.notes).toLowerCase();
                
                if (searchStr.includes(term)) {
                    const card = document.createElement('div');
                    card.className = "card bg-white rounded-lg p-5 border border-slate-200 shadow-sm flex flex-col h-full";
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <h4 class="font-bold text-lg text-slate-800">${test.name}</h4>
                            <span class="category-badge ${test.catClass}">${test.category}</span>
                        </div>
                        <div class="mb-4 flex-grow">
                            <p class="text-sm font-semibold text-slate-700 mb-1">When to use:</p>
                            <p class="text-sm text-slate-600 mb-3">${test.when}</p>
                            
                            <p class="text-xs font-semibold text-slate-500 uppercase tracking-wide mb-1">Example</p>
                            <p class="text-sm text-slate-600 italic border-l-2 border-teal-200 pl-2">${test.example}</p>
                        </div>
                        <div class="mt-auto pt-3 border-t border-slate-100 text-xs text-slate-400">
                            ${test.notes}
                        </div>
                    `;
                    grid.appendChild(card);
                }
            });
        }

        function filterCards() {
            const input = document.getElementById('searchInput');
            renderCards(input.value);
        }

        // --- WIZARD LOGIC ---
        let wizState = { type: null, sub: null, dist: null };

        function resetWizard() {
            wizState = { type: null, sub: null, dist: null };
            document.getElementById('step2-continuous').classList.add('hidden');
            document.getElementById('step3-normality').classList.add('hidden');
            document.getElementById('wizardResult').classList.add('hidden');
        }

        function selectType(type) {
            wizState.type = type;
            document.getElementById('wizardResult').classList.add('hidden');
            document.getElementById('step2-continuous').classList.add('hidden');
            document.getElementById('step3-normality').classList.add('hidden');

            if (type === 'continuous') {
                document.getElementById('step2-continuous').classList.remove('hidden');
            } else if (type === 'categorical') {
                showResult("Chi-square or Fisher's Exact", "Use Chi-square for large samples, Fisher's for small (counts < 5).");
            } else if (type === 'time') {
                showResult("Kaplan-Meier or Cox Regression", "Use Kaplan-Meier for curves, Cox for multivariable analysis.");
            }
        }

        function selectContinuous(sub) {
            wizState.sub = sub;
            document.getElementById('step3-normality').classList.add('hidden');
            document.getElementById('wizardResult').classList.add('hidden');
            document.getElementById('step3-normality').classList.remove('hidden');
        }

        function selectDistribution(dist) {
            wizState.dist = dist;
            let result = "";
            let desc = "";

            if (wizState.sub === '2groups') {
                if (dist === 'normal') {
                    result = "Student's t-test (Two-Tailed)";
                    desc = "Use Independent t-test for separate groups, Paired t-test for same subjects. Typically two-tailed.";
                } else {
                    result = "Mann-Whitney U or Wilcoxon Signed-Rank";
                    desc = "Use Mann-Whitney for separate groups, Wilcoxon for paired samples.";
                }
            } else if (wizState.sub === '3groups') {
                if (dist === 'normal') {
                    result = "ANOVA (and Tukey's Post-hoc)";
                    desc = "One-Way or Two-Way ANOVA. Requires a post-hoc test like Tukey's HSD if significant.";
                } else {
                    result = "Kruskal-Wallis H Test";
                    desc = "Non-parametric alternative to ANOVA. Use Dunn's test post-hoc.";
                }
            } else if (wizState.sub === 'relationship') {
                if (dist === 'normal') {
                    result = "Pearson Correlation";
                    desc = "Measures linear relationship (r).";
                } else {
                    result = "Spearman Correlation";
                    desc = "Rank-based correlation for non-normal/ordinal data.";
                }
            }

            showResult(result, desc);
        }

        function showResult(title, description) {
            const resBox = document.getElementById('wizardResult');
            const resText = document.getElementById('resultText');
            const resDesc = document.getElementById('resultDesc');
            
            resText.textContent = title;
            resDesc.textContent = description;
            resBox.classList.remove('hidden');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderCards();
            loadData(); // Load initial data for playground
            lucide.createIcons();
        });

    </script>
</body>

</html>
